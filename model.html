<html>

<head>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
</head>

<body>
    <a-scene cursor="rayOrigin: mouse">
        <a-assets>
            <!-- Fondos i interfície -->
            <img id="fondo1" src="Assets/imagenes/1.png">
            <img id="fondo2" src="Assets/imagenes/2.png">
            <img id="fondo3" src="Assets/imagenes/3.png">
            <img id="fondo4" src="Assets/imagenes/4.png">
            <img id="fondo5" src="Assets/imagenes/5.png">
            <img id="fondo6" src="Assets/imagenes/6.png">
            <img id="fondo7" src="Assets/imagenes/7.png">
            <img id="fondo8" src="Assets/imagenes/8.png">
            <img id="fondo9" src="Assets/imagenes/9.png">
            <img id="fondo_blancoYnegro" src="Assets/imagenes/fondo_blancoYnegro.png">
            <img id="fondo_principal" src="Assets/imagenes/fondo_principal.png">

            <!--imatge del plano-->
            <img id="dibuplano" src="Assets/imagenes/plano.png">

            <!--imatges de banderes-->
            <img id="bes" src="Assets/imagenes/bes.png">
            <img id="bcat" src="Assets/imagenes/bcat.png">
            <img id="buk" src="Assets/imagenes/buk.png">

        </a-assets>

        <a-entity camera look-controls wasd-controls="false"></a-entity>

        <!-- Entorn 360 inicial (menu d'idiomes) -->
        <a-sky id="sky" src="#fondo_blancoYnegro"></a-sky>
        <!-- Mostra les tres banderes -->
        <a-plane id="es" position="-1.5 -0.5 -2" src="#bes" rotation="0 0 0" scale="1 1 1" botocastella></a-plane>
        <a-plane id="cat" position="0 -0.5 -2" src="#bcat" rotation="0 0 0" scale="1 1 1" botocatala></a-plane>
        <a-plane id="uk" position="1.5 -0.5 -2" src="#buk" rotation="0 0 0" scale="1 1 1" botoangles></a-plane>

        <!-- Deixa el mapa a punt per mostrar a la propera-->
        <a-plane id="plano" position="0 -1 -2" src="#dibuplano" rotation="0 0 0" scale="2 1 2"
            visible="false"></a-plane>

        <!-- 9 punts (botons esfèrics) -->
        <a-sphere id="esfera1" class="esfera" data-index="1" botofondo position="-1.2 -0.7 -2" radius="0.06" color="blue" visible="false"
            animation="property: scale; dur: 1000;  to: 1.2 1.2 1.2; dir: alternate;  loop: true"></a-sphere>
        <a-sphere id="esfera2" class="esfera" data-index="2" botofondo position="-0.6 -0.9 -2" radius="0.06" color="blue" visible="false"
            animation="property: scale; dur: 1000;  to: 1.2 1.2 1.2; dir: alternate;  loop: true"></a-sphere>
        <a-sphere id="esfera3" class="esfera" data-index="3" botofondo position="0 -1.0 -2" radius="0.06" color="blue" visible="false"
            animation="property: scale; dur: 1000;  to: 1.2 1.2 1.2; dir: alternate;  loop: true"></a-sphere>
        <a-sphere id="esfera4" class="esfera" data-index="4" botofondo position="0.6 -0.9 -2" radius="0.06" color="blue" visible="false"
            animation="property: scale; dur: 1000;  to: 1.2 1.2 1.2; dir: alternate;  loop: true"></a-sphere>
        <a-sphere id="esfera5" class="esfera" data-index="5" botofondo position="1.2 -0.7 -2" radius="0.06" color="blue" visible="false"
            animation="property: scale; dur: 1000;  to: 1.2 1.2 1.2; dir: alternate;  loop: true"></a-sphere>
        <a-sphere id="esfera6" class="esfera" data-index="6" botofondo position="-1.2 -1.4 -2" radius="0.06" color="blue" visible="false"
            animation="property: scale; dur: 1000;  to: 1.2 1.2 1.2; dir: alternate;  loop: true"></a-sphere>
        <a-sphere id="esfera7" class="esfera" data-index="7" botofondo position="-0.4 -1.6 -2" radius="0.06" color="blue" visible="false"
            animation="property: scale; dur: 1000;  to: 1.2 1.2 1.2; dir: alternate;  loop: true"></a-sphere>
        <a-sphere id="esfera8" class="esfera" data-index="8" botofondo position="0.4 -1.6 -2" radius="0.06" color="blue" visible="false"
            animation="property: scale; dur: 1000;  to: 1.2 1.2 1.2; dir: alternate;  loop: true"></a-sphere>
        <a-sphere id="esfera9" class="esfera" data-index="9" botofondo position="1.2 -1.4 -2" radius="0.06" color="blue" visible="false"
            animation="property: scale; dur: 1000;  to: 1.2 1.2 1.2; dir: alternate;  loop: true"></a-sphere>

        <!-- Botó per tornar al menú d'idiomes (casa) -->
        <a-plane id="casa" position="1.8 -0.9 -1.8" src="#casa" rotation="0 0 0" scale="0.4 0.4 0.4" visible="false" backtomenu></a-plane>


        <!-- Element de so -->
        <a-entity id="sound" sound></a-entity>
    </a-scene>


    <script>
        const sky = document.querySelector('#sky');
        const sound = document.querySelector('#sound');
        let idioma = "cat"
        const banderaEs = document.querySelector('#es');
        const banderaCat = document.querySelector('#cat');
        const banderaUk = document.querySelector('#uk');
        const esferaEls = document.querySelectorAll('.esfera');
        const mapa = document.querySelector('#plano');
        const casa = document.querySelector('#casa');

        //elimina el moviment de les tecles del cursor
        document.querySelector("[camera]").removeAttribute("wasd-controls");

        //funció per sonar audio, va a buscar la carpeta de l'idioma
        function playAudio(nomFitxer) {
            const ruta = `assets/audios/${idioma}/${nomFitxer}.mp3`;
            console.log('Playing', ruta);
            try {
                if (sound.components && sound.components.sound && sound.components.sound.isPlaying) {
                    sound.components.sound.stopSound();
                }
            } catch (e) { }
            sound.setAttribute('sound', `src: ${ruta}`);
            // small timeout to let A-Frame register the new src
            setTimeout(() => {
                if (sound.components && sound.components.sound) {
                    sound.components.sound.playSound();
                }
            }, 50);
        }


        //si prem boto angles, carrega la imatge 00
        //deixa de mostrar les banderes, mostra el mapa
        //mostra els punts d'interes i sona la locució inicial en l'idioma que toca
        AFRAME.registerComponent("botoangles", {
            init: function () {
                this.el.addEventListener("click", (e) => {
                    // Show main background and interface
                    sky.setAttribute('src', '#fondo_principal');
                    banderaEs.setAttribute('visible', false);
                    banderaCat.setAttribute('visible', false);
                    banderaUk.setAttribute('visible', false);
                    esferaEls.forEach(el => el.setAttribute('visible', true));
                    mapa.setAttribute('visible', true);
                    casa.setAttribute('visible', true);
                    idioma = "en"
                    playAudio("intro");
                })
            }
        });

        AFRAME.registerComponent("botocatala", {
            init: function () {
                this.el.addEventListener("click", (e) => {
                    sky.setAttribute('src', '#fondo_principal');
                    banderaEs.setAttribute('visible', false);
                    banderaCat.setAttribute('visible', false);
                    banderaUk.setAttribute('visible', false);
                    esferaEls.forEach(el => el.setAttribute('visible', true));
                    mapa.setAttribute('visible', true);
                    casa.setAttribute('visible', true);
                    idioma = "cat"
                    playAudio("intro");
                })
            }
        });

        AFRAME.registerComponent("botocastella", {
            init: function () {
                this.el.addEventListener("click", (e) => {
                    sky.setAttribute('src', '#fondo_principal');
                    banderaEs.setAttribute('visible', false);
                    banderaCat.setAttribute('visible', false);
                    banderaUk.setAttribute('visible', false);
                    esferaEls.forEach(el => el.setAttribute('visible', true));
                    mapa.setAttribute('visible', true);
                    casa.setAttribute('visible', true);
                    idioma = "es"
                    playAudio("intro");
                })
            }
        });

        // Component per als botons esfèrics que carreguen els fondos i so corresponent
        AFRAME.registerComponent('botofondo', {
            init: function () {
                this.el.addEventListener('click', (e) => {
                    const idx = this.el.getAttribute('data-index') || this.el.id.replace(/[^0-9]/g, '');
                    if (!idx) return;
                    sky.setAttribute('src', `#fondo${idx}`);
                    playAudio(`${idx}`);
                });
            }
        });

        // Component per tornar al menú d'idiomes
        AFRAME.registerComponent('backtomenu', {
            init: function () {
                this.el.addEventListener('click', (e) => {
                    sky.setAttribute('src', '#fondo_blancoYnegro');
                    banderaEs.setAttribute('visible', true);
                    banderaCat.setAttribute('visible', true);
                    banderaUk.setAttribute('visible', true);
                    esferaEls.forEach(el => el.setAttribute('visible', false));
                    mapa.setAttribute('visible', false);
                    casa.setAttribute('visible', false);
                });
            }
        });

        AFRAME.registerComponent("bototorre", {
            init: function () {
                this.el.addEventListener("click", (e) => {
                    sky.setAttribute('src', '#i01'); //Mostra la imatge de la torre                
                    if (sound.components.sound.isPlaying) {
                        sound.components.sound.stopSound(); // Para el so si ja s'està reproduint
                    }
                    playAudio("torre");
                })
            }
        });
        AFRAME.registerComponent("botoermita", {
            init: function () {
                this.el.addEventListener("click", (e) => {
                    sky.setAttribute('src', '#i02'); //Mostra la imatge de la torre                
                    if (sound.components.sound.isPlaying) {
                        sound.components.sound.stopSound(); // Para el so si ja s'està reproduint
                    }
                    playAudio("ermita");
                })
            }
        });

    </script>
</body>

</html>